function messageWarning(msg) {
    let selectCarWarning = $('<div class="alert alert-warning alert-dismissible fade show message-warning" role="alert">\n' +
        `  <strong>Внимание!</strong> ${msg}\n` +
        '  <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n' +
        '    <span aria-hidden="true">&times;</span>\n' +
        '  </button>\n' +
        '</div>');
    $(selectCarWarning).hide();
    $('body').append(selectCarWarning);
    $(selectCarWarning).show('slow');
    setTimeout(() => {
        selectCarWarning.hide('slow');
        setTimeout(() => {
            selectCarWarning.remove();
        }, 1000);
    }, 3000);
}

$(document).delegate('.sidebar-menu_header_open', 'click', function() {
    $('aside.sidebar').addClass('sidebar-open');
});
$(document).delegate('.sidebar-menu_header_close', 'click', function() {
    $('aside.sidebar').removeClass('sidebar-open');
});

$(document).delegate('.sidebar-menu-item_angle', 'click', function() {
    if(!$(this).parent('.sidebar-menu-item').children('.sidebar-menu-categories').hasClass('sidebar-menu-categories_open')) {
        $('.sidebar-menu-item').removeClass('active');
        $('.sidebar-menu-item_angle').removeClass('active');
        $('.sidebar-menu-categories_open').removeClass('sidebar-menu-categories_open');
    }
    $(this).parent('.sidebar-menu-item').toggleClass('active');
    $(this).toggleClass('active');
    $(this).parent('.sidebar-menu-item').children('.sidebar-menu-categories').toggleClass('sidebar-menu-categories_open');
});

function activeSlider(sliderSelector, inputSelector) {
    $(sliderSelector).slider({
        range: true,
        min: $(sliderSelector).data('min'),
        max: $(sliderSelector).data('max'),
        values: [$(sliderSelector).data('start'), $(sliderSelector).data('end')],
        slide: function( event, ui ) {
            $(ui.handle).parents('.form-group').find('input').val(ui.values[0] + " - " + ui.values[1]);
        }
    });

    $(inputSelector).val($(sliderSelector).slider("values", 0) +
        " - " + $(sliderSelector).slider("values", 1));

    $(document).delegate(inputSelector, 'focusin', function() {
        $(this).data('oldVal', $(this).val());
    });

    $(document).delegate(inputSelector, 'input', function() {
        $(this).prop('readonly', true);
        messageWarning('Извините, но ввод с клавиатуры пока не работает!');
        setTimeout(() => {
            $(this).val($(this).data('oldVal'));
            $(this).prop('readonly', false);
        }, 2000)
    });

}

activeSlider("#slider-range-age", "#age");
activeSlider("#slider-range-flights", "#flights");
activeSlider("#slider-range-experience", "#experience");
activeSlider("#slider-range-mileage", "#mileage");
activeSlider("#slider-range-carFlights", "#carFlights");
activeSlider("#slider-range-yearCar", "#yearCar");
activeSlider('.slider-range-carrying', '.carrying');
activeSlider('.slider-range-controls', '.slider-range-input');


$(document).on('change', '.form-group_gender input', function () {
    if(!$(this).prop('checked')) {
        $(this).prop('checked', false);
    }
    else {
        $('.form-group_gender input').prop('checked', false);
        $(this).prop('checked', true);
    }
});

function activeDatePicker(idFrom, idTo, maxYear) {
    $(idFrom).val("01-01-1990");

    $(idFrom).datepicker({
        changeYear: true,
        yearRange: '1990:' + maxYear,
        dayNamesMin: ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
        buttonImage: url_path + '/img/pick.png',
        dateFormat: 'dd-mm-yy',
        showOn: 'both',
    });

    let toDay = (new Date().getDate()) + '-' + (new Date().getMonth()) + '-' + (new Date().getFullYear());
    $(idTo).val(toDay);

    $(idTo).datepicker({
        changeYear: true,
        yearRange: '1990:' + maxYear,
        dayNamesMin: ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
        buttonImage: url_path + '/img/pick.png',
        dateFormat: 'dd-mm-yy',
        showOn: 'both',
    });
}

function activeDatePickerOne(idInput) {
    $(idInput).datepicker({
        changeYear: true,
        yearRange: '1970:' + (new Date().getFullYear()),
        dayNamesMin: ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
        buttonImage: url_path + '/img/pick.png',
        dateFormat: 'yy-mm-dd',
        showOn: 'both',
    });
}

activeDatePicker('#dateFlightFrom', '#dateFlightTo', 2021);
activeDatePicker("#dateCarFlightFrom", "#dateCarFlightTo", 2021);
activeDatePicker(".datepicker-from", ".datepicker-to", 2021);
activeDatePickerOne('#dateAgeUser');

// datapicker no both begin
$('.input-datepicker__noboth').datepicker({
    changeYear: true,
    yearRange: '1970:' + (new Date().getFullYear()),
    dayNamesMin: ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
    dateFormat: 'dd-mm-yy'
});
const inputsDatepicker__noboth =  $('.input-datepicker__noboth');
for(const input of inputsDatepicker__noboth) {
    
    if(!$(input).val() && $(input).data('auto')) {
        $(input).val((new Date().getDate()) + '-' + (new Date().getMonth()) + '-' + (new Date().getFullYear()));
    }
}
// datepicker no both end



$(document).delegate('.form-group-car_delete', 'click', function() {
    $(this).parents('.form-group-car').hide('slow');
    setTimeout(() => {
        $(this).parents('.form-group-car').remove();
    }, 1000);
});

$(document).delegate('.btn-add-group-car', 'click', function() {
    let formSelectCars = $(this).parent('.form-group');

    let arrSelectCarMark = $(formSelectCars).find('.select-car_mark');
    for(let i = 0; i < arrSelectCarMark.length; i++) {
        if($(arrSelectCarMark[i]).val() == 'Не выбрано') {
            messageWarning('Не выбрана марка автомобиля. Выбирите марку авто!');
            return;
        }
    }

    $(this).remove();

    let formGroupCar = $('<div class="form-group-car">\n' +
        '                          <div class="input-group">\n' +
        '                            <select class="custom-select form-group-car_select select-car_mark rounded">\n' +
        '                              <option selected>Не выбрано</option>\n' +
        '                              <option value="alias1">Рено</option>\n' +
        '                              <option value="alias2">Лада</option>\n' +
        '                              <option value="alias3">Аиди</option>\n' +
        '                            </select><i class="fas fa-times form-group-car_delete fa-2x align-self-center ml-2 mr-1 text-info cp px-1 rounded"></i>\n' +
        '                          </div>\n' +
        '                          <hr class="my-1">\n' +
        '                        </div>');

    let btnAddGroupCar = $('<button class="btn btn-info btn-add-group-car btn-sm" type="button">Добавить</button>');
    $(formGroupCar).hide();
    formSelectCars.append(formGroupCar);
    $(formGroupCar).show('slow');
    formSelectCars.append(btnAddGroupCar);
});

$(document).delegate('.select-car_mark', 'change', function() {
    let selectHr = $('<hr class="my-1">');
    $(selectHr).hide();

    let selectModal = $('<select class="custom-select form-group-car_select select-car_modal mt-2" name="carModel1">\n' +
        '                            <option selected>Не выбрано</option>\n' +
        '                            <option value="aliasModal1">Ларгус</option>\n' +
        '                            <option value="aliasModal2">А4</option>\n' +
        '                            <option value="aliasModel3">А5</option>\n' +
        '                            <option value="aliasModel4">А8</option>\n' +
        '                          </select>');
    if(!$(this).parents('.form-group-car').find('.select-car_modal').length) {
        $(selectModal).hide();
        $(this).parents('.form-group-car').append(selectModal);
        $(selectModal).show('slow');


        $(this).parents('.form-group-car').append(selectHr);
        $(selectHr).show('slow');

        if($(this).parents('.form-group-car').find('hr').length === 3) {
            $(this).parents('.form-group-car').find('hr')[1].remove();
        } else {
            $(this).parents('.form-group-car').find('hr')[0].remove();
        }
    }

    if($(this).val() === 'Не выбрано') {
        $(this).parents('.form-group-car').find('.select-car_modal').hide('slow');
        setTimeout(() => {
            $(this).parents('.form-group-car').find('.select-car_modal').remove();
        }, 1000);
    }
});


$(document).delegate('.driver-cars-title', 'click', function() {
    $(this).find('i').toggleClass('active-icon-90');
    if($(this).parent().find('.driver-cars-list').css('display') == 'none') {
        $(this).parent().find('.driver-cars-list').animate({
            height: 'show'
        }, 500);
    } else {
        $(this).parent().find('.driver-cars-list').animate({
            height: 'hide'
        }, 500);
    }
});

function modalOpen(e) {
    $(`#${$(e).data('modal')}`).modal();
}

$(document).delegate('.form-input-car_mark select', 'change', function() {
    const status = $(this).parents('form').data('status');
    const nameMark = $(this).val();
    const thisSelect = $(this);

    if($(this).val() == 'no') {
        if($(this).parents('.form-input-car').find('.form-input-car_modal').length) {
            $(this).parents('.form-input-car').find('.form-input-car_modal').hide('slow');
            setTimeout(() => {
                $(this).parents('.form-input-car').find('.form-input-car_modal').remove();
            }, 1000);
        }
    } else if($(this).parents('.form-input-car').find('.form-input-car_modal').length) {
        $(this).parents('.form-input-car').find('.form-input-car_modal').remove();
    }

    let request = $.ajax({
        url: url_path + '/car/models',
        data: {
            status: status,
            name_mark: nameMark
        },
        type: 'GET',
        success: function(msg) {
            if(!(nameMark === 'no')) {
                let optionsHtml = msg;
                let inputCarModal = $('<div class="input-group form-input-car_modal mt-3" style="display: none">\n' +
                    '                  <div class="input-group-prepend">\n' +
                    '                    <div class="input-group-text">Модель:</div>\n' +
                    '                  </div>\n' +
                    '                  <select class="custom-select form-control">\n' +
                    '                    <option selected value="no">Не выбрано</option>\n' +
                    optionsHtml +
                    '                  </select>\n' +
                    '                </div>');


                $(thisSelect).parents('.form-input-car').append(inputCarModal);
                $(inputCarModal).show('slow');
            }
        },
        error: function() {
            messageWarning('Ошибка соединения с сервером!<br>' +
                'Попробуйте позже...');
        }
    });
});

function addListYears(selectorSelect, startYear, endYear) {
    let listCarYears = $(selectorSelect).html();
    for(let i = startYear; i <= endYear; i++) {
        listCarYears += `<option value="${i}">${i}</option>\n`;
    }
    if($(selectorSelect).find('option').length == 1) {
        $(selectorSelect).html(listCarYears);
    }
}

addListYears('.select-year-car', 1970, 2010);

$(document).delegate('.driver-cars_icon', 'click', function() {
    $(this).parents('.driver-cars_col').hide('slow');
    setTimeout(() => {
        $(this).parents('.driver-cars_col').remove();
    }, 2000)
});

$('.timeInput').timepicker();

$(document).delegate('.form-selection tbody tr', 'click', function() {
    const thisCar = $(this).find('.form-selection_id').text(),
        thisSelectOption = $(this).find('.form-selection_option i'),
        selectOptions = $('.form-selection .form-selection_option i'),
        inputData = $('.form-selection .form-selection_data');
    selectOptions
        .removeClass('text-success')
        .removeClass('fa-check')
        .addClass('fa-times')
        .addClass('text-danger');
    thisSelectOption
        .removeClass('text-danger')
        .removeClass('fa-times')
        .addClass('fa-check')
        .addClass('text-success');
    inputData.val(thisCar);
});

// delete flights start
$('.table-flights .table-flights_del-btn').on('click', e => {
    $('#del-warning-modal').modal();

    const delBtns = $('.table-flights .table-flights_del-btn');
    delBtns.data('')
});

$(document).delegate('.table-flights .table-flights_del-btn', 'click', function() {
    $('#del-warning-modal').modal();
    $('.table-flights .table-flights_del-btn').data('click', false);
    $(this).data('click', true);
});

function delFlight() {
    const elements = $('.table-flights .table-flights_del-btn');
    for(const element of elements) {
        if($(element).data('click')) {
            $(element).parent().fadeOut();
            setTimeout(() => {
                $(element).parent().remove();
            }, 1000);
        }
    }
    elements.data('click', false);
}

function cancelDelFlight() {
    $('.table-flights .table-flights_del-btn').data('click', false);
}

$(document).delegate('.card.card-car .card-footer .btn-send-repair', 'click', function() {
    let btnTrue = $('<button class="btn btn-success btn-send-repair btn-sm" data-car="f878ss177" data-repair="false">' +
            'Отправить машину в ремонт ' +
            '<i class="fas fa-wrench"></i>' +
        '</button>');
    let btnFalse = $('<button class="btn btn-secondary btn-send-repair btn-sm" data-car="f878ss177" data-repair="true">' +
        'Забрать машину из ремонта ' +
        '<i class="fas fa-wrench"></i>' +
        '</button>');
    if(!$(this).data('repair')) {
        $(this).parent().html(btnFalse);
    } else {
        $(this).parent().html(btnTrue);
    }
});

// form group begin
$(document).delegate('.form-group .btn-add-group-user', 'click', function() {
    const formGroupUser = $('<div class="form-group-user" style="display: none"><span>Фамилия</span>\n' +
        '                                <div class="input-group">\n' +
        '                                  <select class="custom-select rounded">\n' +
        '                                    <option selected="">Не выбрано</option>\n' +
        '                                    <option value="alias1">Поляев</option>\n' +
        '                                    <option value="alias2">Звеньев</option>\n' +
        '                                    <option value="alias3">Мельников</option>\n' +
        '                                  </select><i class="fa fa-times text-info fa-2x align-self-center cp ml-2 form-group-user_del"></i>\n' +
        '                                </div><span>Имя</span>\n' +
        '                                <select class="custom-select">\n' +
        '                                  <option selected="">Не выбрано</option>\n' +
        '                                  <option value="alias1">Александр</option>\n' +
        '                                  <option value="alias2">Василий</option>\n' +
        '                                  <option value="alias3">Максим</option>\n' +
        '                                </select><span>Отчество</span>\n' +
        '                                <select class="custom-select">\n' +
        '                                  <option selected="">Не выбрано</option>\n' +
        '                                  <option value="alias1">Александрович</option>\n' +
        '                                  <option value="alias2">Андреевич</option>\n' +
        '                                  <option value="alias3">Анатольевич</option>\n' +
        '                                </select>\n' +
        '                                <hr class="my-1">\n' +
        '                              </div>');
    $(this).before(formGroupUser);
    formGroupUser.show('slow');
});

$(document).delegate('.form-group .form-group-user_del', 'click', function() {
    $(this).parents('.form-group-user').hide('slow');
    setTimeout(() => {
        $(this).parents('.form-group-user').remove();
    },1000);
});
// form group end

// start form reasons dismis

$(document).delegate('.form-reasons-dismis .form-reasons-dismis_del', 'click', function() {
    $(this).parent().hide('slow');
    setTimeout(() => {
        $(this).parent().remove();
    }, 1000);
});

$(document).delegate('.form-reasons-dismis_add', 'click', function() {
    const inputReasonDismis = $('<div class="input-group mt-2" style="display: none">\n' +
        '                <input class="form-control rounded form-reasons-dismis_input"><i class="fas fa-times text-info fa-2x form-reasons-dismis_del align-self-center ml-2 rounded px-2"></i>\n' +
        '              </div>');
    const form = $(this).parents('.modal-content').find('.form-reasons-dismis');
    form.append(inputReasonDismis);
    inputReasonDismis.show('slow');
});

// end form reasons dismis

// start form add photo
$(document).delegate('.form-add-photo .form-add-photo_number', 'change', function() {
    const user = $('<h6 class="form-add-photo_user border rounded p-2">Поляев Максим Александрович</h6>');
    const form = $(this).parents('.form-add-photo');

    if(form.find('.form-add-photo_user').length) {
        form.find('.form-add-photo_user').remove();
    }

    $(this).parent('.input-group').after(user);
});
// end form add photo

$('#user_photo_input').on('change', function() {
    let fileName = $(this).val();
    //replace the "Choose a file" label
    $(this).next('.custom-file-label').html(fileName);
});